# ТЕСТОВОЕ ЗАДАНИЕ ПРОКСИ ЧЕКЕР

## Кратка выжимка ТЗ

Требуется написать чекер прокси, предпочтительно на фреймворке Laravel.

## Основные разделы

1. **Проверка прокси**: ввод прокси в формате ip:port, проверка с максимальной скоростью, многопоточность.
2. **История проверок**: архив с датой, временем, количеством прокси и их статусом.

## Результаты работы скрипта

- **IP:Port**
- **Тип прокси (HTTP/SOCKS)**
- **Страна/город прокси**
- **Статус (работает/не работает)**
- **Скорость скачивания или таймаут**
- **Реальный внешний IP прокси**
- **Общее количество проверенных прокси и количество рабочих**

## Дополнительные пункты (по возможности)

- **Раздел архива с детальной информацией по проверкам**
- **Показ результатов и прогресс-бар проверки AJAX'ом**

## Важные моменты

- **Качество кода, его структура и соответствие конвенциям**
- **Задавать вопросы для комфортного общения**
- **Использование предыдущего опыта и кода**
- **Комментирование кода для удобства чтения**

## Проблемы и нереализованный функционал за пробный день

1. **Выбранный geolocation api показался наиболее подходящим под задачу, но при проведении тестирования приложения начал отдавать 403 ошибку из-за запросов внутри сервиса, запросы с postman и tinker принимал**
2. **Не реализован графический интерфейс (не хватило времени)**
3. **Не закончен дебаг проекта. Не хватило рабочего дня на проведение дебага всего написанного функционала + наложившаяся ошибка 403 затруднила дебаг**

## О проекте

В рамках ТЗ был написан CheckerProxyConnector выполняющий функцию общения с https://api.ipgeolocation.io/ipgeo. Коннектор необходим исключительно для общения между сервисами и не более.

Написан ProxyCheckerServiceProvider для внедрения коннектора в код через DI тем самым упростив локаничность и понимание кода

Созданы роуты в api.php для общения с апи нашего прокси-чекера:

1. **POST api/proxy-checker**: необходим для запуска проверки проксей, принимает аргумент proxies
2. **GET api/proxy-checker/archive**: выполняет функцию получения всех проксей по группам которые проверялись ранее
3. **api/proxy-checker/{proxyGroup}**: выполняет функцию получения проксей по конкретной группе. Необходим для отображения информации о проверенных прокси из первого запроса.

---------------

Написаны Модели Proxy и ProxyGroup

1. **Proxy**: список проверяемых Proxy
2. **ProxyGroup**: объединяет прокси по проводимым поискам и сигнализирует о статусе проверки списка проксей за счёт state

Был написан ProxyCheckerController для обрабатки маршрутов. Опишем флоу методов:

### checkProxy

1. **Валидирует значения за счёт CheckProxyRequest**
2. **За счёт try...catch определяет какой response подходит**
3. **Делегирует задачу по проверки полученных прокси в ProxyCheckerActon**
4. **ProxyCheckerAction**:
   1. **Принимает список прокси**
   2. **Запускает транзакцию для отмены обработки всех проксей, если есть проблемы с общим объёмом данных**
   3. **Создаёт группу проксей для объединения проксей**
   4. **Разбивает проксю на ip и port создавая запись в БД**
   5. **Вызывается event ProxyCreatedEvent принимающий проксю**
   6. **Вызывается CheckProxyListener, который привязан к event в AppServiceProvider**
   7. **Listener производит диспатч CheckProxyJob для проверки прокси через geolocationApi**
   8. **CheckProxyJob**:
      1. **За счёт DI принимает в себя Connector**
      2. **Начинает просчёт timeout проверки прокси через microtime**
      3. **Получает данные о проксе за счёт коннектора**
      4. **Декодирует данные ответа от коннектора и записывает в них Timeout**
      5. **Создаёт DTO на основании полученных данных**
      6. **Обновляет прокси используя DTO и вызывает тем самым ProxyUpdatedEvent**
   9. **ProxyUpdatedEvent**
      1. **Привызывается к CheckProxyGroupListener в AppServiceProvider**
      2. **CheckProxyGroupListener**
         1. **при обновлении проксей проверяет сколько проксей ещё имеют статус processing**
         2. **определить когда проверка проксей завершена и обновить state группы проксей на finished**

### checkProxyList

1. **Принимает в себя ProxyGroup за счёт роут биндинга**
2. **ПРоверяет статус группы для проведения long pool опроса, если проверка группы проксей ещё не завершена**
3. **Если группа проверена, то возвращается список проксей (можно дополнить также сколько из скольки проксей было проверено)**

### getArchiveProxy

1. **Запрос в БД на получение всех ранее проверяемых групп, которые имеют статус finished**
